<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>ALL THE THINGS</title>
    <script type="text/javascript" src="../lib/d3/d3.v3.js"></script>
</head>

<body>

    <div id="chart2005"></div>
    <div id="chart2006"></div>
    <div id="chart2007"></div>
    <div id="chart2008"></div>
    <div id="chart2009"></div>
    <div id="chart2010"></div>
    <div id="chart2011"></div>
    <div id="chart2012"></div>
    <div id="chart2013"></div>


    <script type="text/javascript">
        var dataset;
        var data;
        var chart1Data = {};
        var listCountries;
        var ALLTHEDATA ={};
        var years = [2005,2006,2007,2008,2009,2010,2011,2012,2013];
        var strYears = ['2005','2006','2007','2008','2009','2010','2011','2012','2013'];
        var max;
        var margin = {
                top: 30,
                right: 20,
                bottom: 40,
                left: 60
            },

            width = 1000 - margin.left - margin.right,
            height = 700 - margin.top - margin.bottom;


        d3.json("asdfghjkl.json", function(error, json) {
            if (error) return console.warn(error);
            dataset = json;


            json.forEach(function(d) {
                var tempValue = +(d['Refugees (incl. refugee-like situations)']);

                if (typeof(tempValue) === 'number' && tempValue != NaN) {
                    if (chart1Data[d['Origin']] == undefined) {
                        var tempDict = {};
                        tempDict[d['Year']] = tempValue;
                        chart1Data[d['Origin']] = tempDict
                    } else {
                        if (chart1Data[d['Origin']][d['Year']] == undefined) {
                            chart1Data[d['Origin']][d['Year']] = tempValue;
                        } else {
                            chart1Data[d['Origin']][d['Year']] = chart1Data[d['Origin']][d['Year']] + tempValue;
                        }
                    }

                }


            });


            listCountries = Object.keys(chart1Data);

            for(var merp in years){
                var graphData = {};
                for (var tempKey in listCountries) {
                    graphData[tempKey] = chart1Data[listCountries[tempKey]][strYears[merp]];
                }
                ALLTHEDATA[merp] = graphData;
            }

            max = d3.max(ALLTHEDATA, function(d) {
                return d;
            });

            var force = d3.layout.force()
                .charge(-300)
                .gravity(.05)
                .distance(200)
                .size([width/3, height/3]);

            var svg = d3.select('#chart2005').append("svg")
                .attr("width", width)
                .attr("height", height);

            force
                .nodes(ALLTHEDATA[0])
                .start();

            var gnodes = svg.selectAll('g.gnode')
                .data(ALLTHEDATA[0])
                .enter()
                .append('g')
                .classed('gnode', true);

            var node = svg.selectAll(".node")
                .data(ALLTHEDATA[0])
                .enter().append("circle")
                .attr("class", "node")
                .attr("r", 5)
                // .text(function(d){ return d.name;})
                .call(force.drag);

            force.on("tick", function() {
                node.attr("cx", function(d) { return d.x; })
                    .attr("cy", function(d) { return d.y; });
  });


        });


        function loadChart1(currYear) {
            
            var xscale = d3.scale.linear()
                .domain([0, max])
                .range([0, width]);

            var yscale = d3.scale.linear()
                .domain([0, listCountries.length])
                .range([1, height]);



            var svg = d3.select("#chart1")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var bar = svg.selectAll("g")
                .data(graphData)
                .enter().append("g")
                .attr("transform", function(d, i) {
                    return "translate(0," + d * 20 + ")";
                });
            var tempHeight = height + 10;
            var tempLeft = margin.left + 50;
            var tempTop = margin.top + 10;
            var chart = svg.append('g')
                .attr("transform", "translate(" + tempLeft + "," + margin.top + ")")
                .attr('id', 'bars')
                .selectAll('rect')
                .data(graphData)
                .enter()
                .append('rect')
                .attr('height', height / listCountries.length * 2 / 3)
                .attr({
                    'x': 0,
                    'y': function(d, i) {
                        return yscale(+i);
                    }
                })
                .attr('width', function(d) {
                    return xscale(+d);
                });


        }


    </script>
</body>

</html>